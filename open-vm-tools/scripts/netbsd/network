#!/bin/sh
##########################################################
# Copyright (C) 2010-2017 VMware, Inc. All rights reserved.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU Lesser General Public License as published
# by the Free Software Foundation version 2.1 and no later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the Lesser GNU General Public
# License for more details.
#
# You should have received a copy of the GNU Lesser General Public License
# along with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA.
#
##########################################################

##########################################################################
# DO NOT modify this file directly as it will be overwritten the next
# time the VMware Tools are installed.
##########################################################################

#
# network (NetBSD)
#
# This script uses NetBSD's rc(8) scripts to stop and restart networking
# services in response to suspend and resume events, respectively.
#


echo `date` ": Executing '$0'"
echo

. `dirname "$0"`/../../statechange.subr


#
# ToggleNetwork --
#
#    Sources native configuration files in a subshell and executes native
#    scripts to either start or stop networking services associated with
#    a single interface.
#
# Results:
#    See description above.
#
# Side effects:
#    All side effects implied by NetBSD's rc.d scripts.
#

ToggleNetwork() {
   (
      /etc/rc.d/dhcpcd $1
   )
}


#
# main --
#
#    Main entry point.  Perform some sanity checking, then map state change
#    events to relevant networking operations.
#
# Results:
#    See comment at top of file.
#

main() {
   exitCode=0

   [ -x /etc/rc.d/dhcpcd ] || \
      Panic "Cannot find an executable /etc/rc.d/dhcpcd"

   case "$1" in
      suspend-vm)
         ToggleNetwork stop
         ;;
      resume-vm)
         ToggleNetwork start
         ;;
      *) ;;
   esac

   return $exitCode
}

main "$@"
